<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>JobFusion AI - Resume Analyzer</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    .step { display: none; }
    .active { display: block; }
    .btn { padding: 8px 14px; margin: 6px; background: #007bff; color: white; border: none; cursor: pointer; }
    .btn:disabled { background: gray; cursor: not-allowed; }
    .result-box { background: #f9f9f9; padding: 12px; margin-top: 10px; border-radius: 6px; }

    /* Score colors */
    .score-good { color: green; font-weight: bold; }
    .score-mid { color: darkorange; font-weight: bold; }
    .score-bad { color: red; font-weight: bold; }

    /* Suggestions */
    .suggestion-list { list-style: none; padding: 0; }
    .suggestion-list li { margin: 6px 0; padding: 6px; border-radius: 4px; }
    .suggestion-bad { background: #ffe5e5; color: #a30000; }
    .suggestion-mid { background: #fff4e5; color: #a35b00; }
    .suggestion-good { background: #e6ffe6; color: #006600; }
  </style>
</head>
<body>
  <h1>JobFusion AI - Resume ATS Analyzer</h1>

  <!-- Step 1 -->
  <div id="step1" class="step active">
    <h2>Step 1: Upload Resume</h2>
    <form id="resumeForm">
      <input type="file" name="resume" required />
      <button type="submit" class="btn">Check Quality</button>
    </form>
    <div id="qualityResult" class="result-box"></div>
    <button class="btn" id="toStep2" disabled>Next ‚Üí</button>
  </div>

  <!-- Step 2 -->
  <div id="step2" class="step">
    <h2>Step 2: Match with Job Description</h2>
    <form id="jdForm">
      <input type="file" name="jdfile" />
      <textarea name="jdText" rows="6" cols="50" placeholder="Or paste Job Description here"></textarea>
      <button type="submit" class="btn">Analyze Match</button>
    </form>
    <div id="jdResult" class="result-box"></div>
    <button class="btn" id="back1">‚Üê Back</button>
    <button class="btn" id="toStep3">Next ‚Üí</button>
  </div>

  <!-- Step 3 -->
  <div id="step3" class="step">
    <h2>Step 3: Interview Questions</h2>
    <form id="interviewForm">
      <textarea name="jdText" rows="6" cols="50" placeholder="Paste Job Description for Questions"></textarea>
      <button type="submit" class="btn">Generate Questions</button>
    </form>
    <div id="qResult" class="result-box"></div>
    <button class="btn" id="back2">‚Üê Back</button>
  </div>

  <script>
    const step1 = document.getElementById("step1");
    const step2 = document.getElementById("step2");
    const step3 = document.getElementById("step3");

    // ---- Step 1 ----
    document.getElementById("resumeForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      const formData = new FormData(e.target);
      const res = await fetch("/uploadResume", { method: "POST", body: formData });
      const data = await res.json();

      let scoreClass = data.buildQualityScore >= 80 ? "score-good" : data.buildQualityScore >= 60 ? "score-mid" : "score-bad";
      let statusMsg = data.buildQualityScore >= 80 ? "‚úÖ Ready to proceed!" : data.buildQualityScore >= 60 ? "‚ö†Ô∏è Needs some improvements" : "‚ùå Major changes required";

      let html = `<p><strong>ATS Build Score:</strong> <span class="${scoreClass}">${data.buildQualityScore}</span> - ${statusMsg}</p>`;

      if (data.suggestions && data.suggestions.length > 0) {
        html += `<strong>Suggestions:</strong><ul class="suggestion-list">`;
        data.suggestions.forEach(s => {
          let sugClass = data.buildQualityScore >= 80 ? "suggestion-good" : data.buildQualityScore >= 60 ? "suggestion-mid" : "suggestion-bad";
          html += `<li class="${sugClass}">üí° ${s}</li>`;
        });
        html += `</ul>`;
      }
      document.getElementById("qualityResult").innerHTML = html;

      // store resumeFileId for Step 2
      window.resumeFileId = data.fileId;

      // enable next only if score ‚â• 80
      document.getElementById("toStep2").disabled = data.buildQualityScore < 80;
    });

    document.getElementById("toStep2").addEventListener("click", () => {
      step1.classList.remove("active");
      step2.classList.add("active");
    });

    // ---- Step 2 ----
    document.getElementById("jdForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      const formData = new FormData(e.target);
      if (window.resumeFileId) formData.append("resumeFileId", window.resumeFileId);
      const res = await fetch("/analyze", { method: "POST", body: formData });
      const data = await res.json();
      document.getElementById("jdResult").innerHTML = `<pre>${JSON.stringify(data, null, 2)}</pre>`;
    });

    document.getElementById("toStep3").addEventListener("click", () => {
      step2.classList.remove("active");
      step3.classList.add("active");
    });
    document.getElementById("back1").addEventListener("click", () => {
      step2.classList.remove("active");
      step1.classList.add("active");
    });

    // ---- Step 3 ----
    document.getElementById("interviewForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      const jdText = e.target.jdText.value;
      const res = await fetch("/interview", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ jdText })
      });
      const data = await res.json();
      document.getElementById("qResult").innerHTML = `<ul>${data.questions.map(q => `<li>${q}</li>`).join("")}</ul>`;
    });

    document.getElementById("back2").addEventListener("click", () => {
      step3.classList.remove("active");
      step2.classList.add("active");
    });
  </script>
</body>
</html>
